<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merge Attendance Files - Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../shared/css/common.css">
    <link rel="stylesheet" href="css/admin.css">
    <!-- SheetJS for Excel parsing -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <style>
        .merge-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .upload-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .upload-box {
            background: white;
            padding: 2rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            border: 2px dashed #e5e7eb;
            text-align: center;
            transition: all var(--transition-base);
        }

        .upload-box:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-lg);
        }

        .upload-box.has-file {
            border-color: var(--accent-green);
            background: #f0fdf4;
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        .upload-box.has-file .upload-icon {
            color: var(--accent-green);
        }

        .file-info {
            margin-top: 1rem;
            padding: 0.75rem;
            background: white;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
        }

        .preview-section {
            background: white;
            padding: 2rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            margin-bottom: 2rem;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: var(--radius-md);
            text-align: center;
        }

        .stat-box.absent {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .stat-box.present {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .upload-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <div id="sidebar-container"></div>

    <!-- Sidebar Toggle Button -->
    <button class="sidebar-toggle" id="sidebar-toggle" title="Toggle Sidebar">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
    </button>

    <div class="main-content">
        <div class="merge-container">
            <div style="margin-bottom: 2rem;">
                <h1>ðŸ“Š Merge Attendance Files</h1>
                <p style="color: var(--text-secondary);">Upload both attendance and absence files to create a merged
                    file for call sessions.</p>
            </div>

            <div id="alert-container"></div>

            <!-- Upload Section -->
            <div class="upload-section">
                <!-- Absent Students File -->
                <div class="upload-box" id="absent-box">
                    <div class="upload-icon">ðŸ“‹</div>
                    <h3>Absent Students File</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">Upload Excel/CSV file with absent
                        students</p>
                    <input type="file" id="absent-file" accept=".xlsx, .xls, .csv" style="display: none;">
                    <button class="btn btn-outline" onclick="document.getElementById('absent-file').click()">
                        Choose File
                    </button>
                    <div id="absent-info" class="file-info" style="display: none;"></div>
                </div>

                <!-- Attendance Students File -->
                <div class="upload-box" id="attendance-box">
                    <div class="upload-icon">âœ…</div>
                    <h3>Attendance Students File</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">Upload Excel/CSV file with attending
                        students</p>
                    <input type="file" id="attendance-file" accept=".xlsx, .xls, .csv" style="display: none;">
                    <button class="btn btn-outline" onclick="document.getElementById('attendance-file').click()">
                        Choose File
                    </button>
                    <div id="attendance-info" class="file-info" style="display: none;"></div>
                </div>
            </div>

            <!-- Merge Button -->
            <div style="text-align: center; margin-bottom: 2rem;">
                <button class="btn btn-primary" id="merge-btn" disabled
                    style="font-size: 1.125rem; padding: 1rem 2rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        style="margin-right: 0.5rem;">
                        <path
                            d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                        </path>
                        <polyline points="7.5 4.21 12 6.81 16.5 4.21"></polyline>
                        <polyline points="7.5 19.79 7.5 14.6 3 12"></polyline>
                        <polyline points="21 12 16.5 14.6 16.5 19.79"></polyline>
                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                        <line x1="12" y1="22.08" x2="12" y2="12"></line>
                    </svg>
                    Merge Files
                </button>
            </div>

            <!-- Preview Section -->
            <div class="preview-section" id="preview-section" style="display: none;">
                <h2>Merged Data Preview</h2>

                <div class="stats-row">
                    <div class="stat-box absent">
                        <div class="stat-value" id="stat-absent">0</div>
                        <div class="stat-label">Absent Students</div>
                    </div>
                    <div class="stat-box present">
                        <div class="stat-value" id="stat-present">0</div>
                        <div class="stat-label">Present Students</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="stat-total">0</div>
                        <div class="stat-label">Total Students</div>
                    </div>
                </div>

                <div style="margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;">
                    <h3>Preview (First 10 rows)</h3>
                    <div>
                        <button class="btn btn-primary" id="download-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Download Merged File
                        </button>
                        <button class="btn btn-outline" id="upload-to-session-btn" style="margin-left: 0.5rem;">
                            Upload to Call Session
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead id="preview-thead"></thead>
                        <tbody id="preview-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="../shared/js/sidebar-template.js"></script>
    <script src="js/sidebar.js"></script>
    <script src="../shared/js/api.js"></script>
    <script src="js/merge-files.js"></script>
</body>

</html>